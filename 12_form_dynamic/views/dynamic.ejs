<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <!-- ajax cdn -->
    <script src="https://code.jquery.com/jquery-3.6.1.min.js" 
    integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" 
    crossorigin="anonymous">
    </script>

    <!-- axiox cdn -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <h1><%= title %></h1>

    <form action="" name="register">
        ì´ë¦„<input type="text" name="name" id="name" required>
        <br>
        ì„±ë³„<input type="radio" name="gender" id="male" value="m" required>ë‚¨ì
        <input type="radio" name="gender" id="female" value="f">ì—¬ì
        <!-- <input type="radio" name="gender" id="others" value="ê·¸ì™¸">ê·¸ì™¸ -->
        <br>
        <button type="button" onclick="ajaxGet()">ajax get ì œì¶œ</button>
        <button type="button" onclick="ajaxPost()">ajax post ì œì¶œ</button>
        <br>
        <button type="button" onclick="axiosGet()">axios get ì œì¶œ</button>
        <button type="button" onclick="axiosPost()">axios post ì œì¶œ</button>
        <br>
        <button type="button" onclick="fetchGet()">fetch get ì œì¶œ</button>
        <button type="button" onclick="fetchPost()">fetch post ì œì¶œ</button>

    </form>
    <div class="result"></div>
    <script>
        const resultBox = document.querySelector('.result');
        function ajaxGet() {
            console.log('############### click ajaxGet');
            // í¼ ì„ íƒí•˜ê¸°
            const form = document.forms['register'];
            // í¼ ê°ì²´ ìš”ì†Œ ë° ìš”ì†Œê°’ í™•ì¸í•˜ê¸°
            console.dir(form);
            console.dir(form.name); // input:text
            console.dir(form.gender);   // input:radio
            console.dir(form.name.value);
            console.dir(form.gender.value);

            const data = {
                name: form.name.value,
                gender: form.gender.value,
            }
            //AJAX ë¹„ë™ê¸° í†µì‹  - GET / ajax ìš”ì²­ ë³´ë‚´ê¸°
            $.ajax({
                type: 'GET',    //ìš”ì²­ ì¢…ë¥˜
                url: '/ajax',   //ìš”ì²­í•  ì„œë²„ ì£¼ì†Œ
                data: data,     //ë³´ë‚¼ ë°ì´í„°
                success: function (data) {
                    console.log('ajax get :',data);
                    resultBox.textContent = `GET / ajax ìš”ì²­ ì™„ë£Œ ${data.name}ë‹˜ì€ ${data.gender}ì´ì‹œì£ ?`;
                    resultBox.style.color = 'blue';
                }
            });
        }
        
        function ajaxPost() {
            console.log('############### click ajaxPost');
            //í¼ ì„ íƒí•˜ê¸°
            const form = document.forms['register'];

            //í¼ ìš”ì†Œê°’ í™•ì¸í•˜ê¸°
            console.dir(form);
            console.dir(form.name);
            console.dir(form.gender);
            console.dir(form.name.value);
            console.dir(form.gender.value);

            const data = {
                name: form.name.value,
                gender: form.gender.value,
            }

            // ajax ë¹„ë™ê¸° í†µì‹  - POST / ajax ìš”ì²­ ë³´ë‚´ê¸°
            $.ajax({
                type: 'POST',
                url: '/ajax',
                data: data,
                success: function (data) {
                    console.log('ajax post:', data);
                    resultBox.textContent = `POST / ajax ìš”ì²­ì™„ë£Œ ${data.name}ë‹˜ì€ ${data.gender}ì´ì‹œì£ ?`
                    resultBox.style.color = 'red';
                }
            })

        }

        function axiosGet() {
            console.log('######click axiosGet #####');

            const form = document.forms['register'];
            const data = {
                name: form.name.value,
                gender: form.gender.value,
            };
            //AXIOS ë¹„ë™ê¸° í†µì‹  - GET ìš”ì²­
            axios({
                method: 'GET',
                url: '/axios',
                params: data,   //GET ìš”ì²­ì€ paramsì— ì •ë³´ë¥¼ ì‹¤ì–´ì„œ ë³´ë‚´ì•¼í•¨
            }).then(function (response) {   //axiosëŠ” promiseë¥¼ ë°˜í™˜í•œë‹¤ -> then ë§¤ì„œë“œ ì‚¬ìš©
                console.log(response);  // ì„œë²„ì˜ ì‘ë‹µê²°ê³¼
                console.log(response.data); // rex.send(req.query)
                console.log(response.data.name);
                console.log(response.data.gender);

                //ì‚¬ìš©ìì˜ ì…ë ¥ì´ ì˜¬ë°”ë¥´ì§€ ì•Šë‹¤ë©´ , axios ìš”ì²­ ì‹œë„ x
                // ì‚¬ìš©ìì˜ ì…ë ¥ì´ ì˜¬ë°”ë¥´ë‹¤ë©´, axios ìš”ì²­ ì‹œë„ o
                
                console.log('ì—¬ê¸°ì—¬ê¸°_name', form.name.checkValidity());
                console.log('ì—¬ê¸°ì—¬ê¸°_gender[0]', form.name.checkValidity());
                resultBox.textContent = `GET / axios ìš”ì²­ì™„ë£Œ ${data.name}ë‹˜ì€ ${data.gender}ì´ì‹œì£ ?ğŸ˜Š`
                resultBox.style.color = 'green';
            });
        }
        function axiosPost() {
            console.log('######click axiosPost #####');

            const form = document.forms['register'];
            const data = {
                name: form.name.value,
                gender: form.gender.value,
            };
            axios({
            method: 'POST',
            url: '/axios',
            data: data, // POST ìš”ì²­ì€ "data"ì— ì •ë³´ë¥¼ ì‹¤ì–´ì„œ ë³´ë‚´ì•¼ ë¨
            }).then(function (response) {
            console.log(response);
            console.log(response.data);

            resultBox.textContent = `POST /axios ìš”ì²­ ì™„ë£Œ!! ${response.data.name}ë‹˜ì€ ${response.data.gender}ì´ì‹œì£ ?ã…ã…`;
            resultBox.style.color = 'gold';
        }); 
        }

         // fetch(url, option)
      function fetchGet() {
        console.log('####### click fetchGet #######');

        const form = document.forms['register'];

        fetch(`/fetch?name=${form.name.value}&gender=${form.gender.value}`, {
          method: 'GET',
        })
          .then(function (response) {
            console.log(response);
            return response.json(); // ì‘ë‹µì„ json í˜•íƒœë¡œ íŒŒì‹± (ë³€í™˜)
          })
          .then(function (data) {
            console.log(data);
            resultBox.textContent = `GET /fetch ìš”ì²­ ì™„ë£Œ!! ${data.name}ë‹˜ì€ ${data.gender}ì´ì‹œì£ ?ã…ã…`;
            resultBox.style.color = 'limegreen';
          });
      }

      function fetchPost() {
        console.log('####### click fetchPost #######');

        const form = document.forms['register'];
        const data = {
          name: form.name.value,
          gender: form.gender.value,
        };

        // fetch(url, option).then().then()
        fetch('/fetch', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        })
          .then(function (response) {
            console.log(response);
            return response.json();
          })
          .then(function (data) {
            console.log(data);
            resultBox.textContent = `POST /fetch ìš”ì²­ ì™„ë£Œ!! ${data.name}ë‹˜ì€ ${data.gender}ì´ì‹œì£ ?ã…ã…`;
            resultBox.style.color = 'hotpink';
          });
      }
    </script>
</body>
</html>