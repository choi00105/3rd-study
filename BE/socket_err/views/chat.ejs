<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì±„íŒ… í”„ë¡œê·¸ë¨</title>
    <!-- ì†Œì¼“ ì—°ê²° -->
    <script 
        src="https://cdn.socket.io/4.5.3/socket.io.min.js" 
        integrity="sha384-WPFUvHkB1aHA5TDSZi6xtDgkF0wXJcIIxXhC6h8OT8EH3fC5PWro5pWJ1THjcfEi" 
        crossorigin="anonymous">
    </script>
    <style>
        .chat-list {
        background-color: skyblue;
        width: 50%;
        height: 500px;
        padding: 10px;
      }

      .chat-list div {
        margin-top: 3px;
      }

      .chat-list div div {
        display: inline-block;
        padding: 3px;
      }

      .my-chat {
        text-align: my-chat ;
      }

      .my-chat div {
        background-color: yellow;
      }

      .other-chat div {
        background-color: white;
      }
        .notice {
            text-align: center;
            color: navy;
            font-size: 12px;
        }
        .d-none {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Socket.io</h1>
    <!-- ì‹¤ìŠµ 44-2 -->
<div class="entry-box">
    <input type="text" name="" id="nickname" placeholder="ë‹‰ë„¤ì„", autofocus>
    <button type="button" onclick="entry();">ì…ì¥</button>
</div>
    <!-- ì‹¤ìŠµ 42 -->
    <!-- <button onclick="sayHello();">hello</button>
    <button onclick="sayStudy();">study</button>
    <button onclick="sayBye();">bye</button>
    <p id="from-server"></p> -->
<!-- [ì‹¤ìŠµ43] ì±„íŒ…ì°½ UI ë§Œë“¤ê¸° -->
<div class="box d-none">
    <div id="chat-list" class="chat-list">
      <!-- [ì‹¤ìŠµ43] ì„ì‹œ ë°ì´í„° -->
      <div class="my-chat">
        <div>user1: msg1</div>
      </div>
      <div class="other-chat">
        <div>user2: msg2</div>
      </div>
      <div class="notice">xxê°€ ì…ì¥í–ˆìŠµë‹ˆë‹¤.</div>
    </div>
    <input type="text" id="message" />
    <button type="button" onclick="send();">ì „ì†¡</button>
  </div>

    <script>
        let socket = io.connect(); // ì†Œì¼“ ì‚¬ìš©ì„ ìœ„í•œ ê°ì²´ ìƒì„±
        let myNick; // ë‚´ ë‹‰ë„¤ì„ ì„¤ì •
        socket.on('connect', () => {
            console.log('====== ğŸ˜€ Client Socket Connected >>', socket.id);
        });

        // ì‹¤ìŠµ 42
        // function setMsg(obj) { // ê²¹ì¹˜ëŠ”ê±´ ë¦¬íŒ©í† ë§
        //     document.querySelector('#from-server').textContent = `${obj.who} : ${obj.msg}`;
        // }

        // function sayHello() {
        //     socket.emit('hello', { who:'client', msg: 'hello' });  
        //     socket.on('helloKr', (data) => {
        //         console.log('socket on helloKr >> ', data,);
        //         setMsg(data);
        //     });            
        // }
        // function sayStudy() {
        //     socket.emit('study', { who:'client', msg: 'study' });  
        //     socket.on('studyKr', (data) => {
        //         console.log('socket on studyKr >> ', data,);
        //         setMsg(data);

        //     });
        // }
        // function sayBye() {
        //     socket.emit('bye', { who:'client', msg: 'bye' });  
        //     socket.on('byeKr', (data) => {
        //         console.log('socket on byeKr >> ', data,);
        //         setMsg(data);

        //     });
        // }
            // ì‹¤ìŠµ 44
        socket.on('notice', (msg) => {
            console.log('Socket on notice >> ', msg);

            document.querySelector('.chat-list').insertAdjacentHTML('beforeend', `<div class="notice">${msg}</div>`);
        });
        // ì‹¤ìŠµ 44-2
        function entry() {
            console.log(document.querySelector('#nickname').value);

            socket.emit('setNick', document.querySelector('#nickname').value);
        }
        socket.on('entrySuccess', (nick) => {
            myNick = nick;
            document.querySelector('#nickname').disabled = true;
            document.querySelector('.entry-box > button').disabled = true;
            document.querySelector('.box').classList.remove('d-none');
        });

        socket.on('error', (data) => {
            alert(data);
        });
        
        // ì‹¤ìŠµ 45 ì±„íŒ…ì°½ ë©”ì„¸ì§€ ì „ì†¡ step1
        // "send" ì´ë²¤íŠ¸ ì „ì†¡í•˜ê¸°
        function send() {
            const data = {
                myNick: myNick,
                msg: document.querySelector('#msg').value,
            };
            socket.emit('send', data);
        }

        // step 2 "newMessage" ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬ë°›ê¸° {ë‹‰ë„¤ì„, ë©”ì„¸ì§€ë‚´ìš©}
        socket.on('newMessage', (data) => {
            console.log('socket on newMsg >> ', data);
            let chatlist = document.querySelector('.chat-list');
            let div = document.createElement('div'); // .my-chat  or .lefr ìƒì„±
            let divChat = document.createElement('div') // ê°€ì¥ ì•ˆìª½ div ë©”ì‹œì§€ ë°•ìŠ¤ ìƒì„±

            if (myNick === data.nick) {
                div.classList.add('my-chat ');
            } else {
                div.classList.add('other-chat');
            }

            divChat.textContent = `${data.nick} : ${data.msg}`;
            div.append(divChat);
            chatlist.append(div);
        });

        
    </script>
    
</body>
</html>